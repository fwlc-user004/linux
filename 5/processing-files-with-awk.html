<section data-intro class="bg-slate-900/20">
  <h2>مقدمه</h2>
  <p>
    تاکنون ابزارهایی مانند grep را برای پیدا کردن خطوط حاوی یک الگو و wc را
    برای شمارش یاد گرفته‌ایم. اما اگر بخواهیم پردازش‌های پیچیده‌تری انجام دهیم، به خصوص روی
    داده‌هایی که ساختار ستونی دارند چطور؟ برای مثال، چگونه می‌توانیم فقط ستون پنجم از خروجی یک دستور
    را استخراج کنیم یا مجموع اعداد یک ستون خاص را محاسبه نماییم؟
  </p>
  <p>
    اینجاست که awk وارد میدان می‌شود. awk (که نام آن از حروف اول نام خانوادگی
    سازندگانش، Aho، Weinberger و Kernighan گرفته شده) یک زبان برنامه‌نویسی کامل است که برای پردازش
    متن، به ویژه داده‌های ستونی، طراحی شده است. awk فایل‌ها را خط به خط می‌خواند، هر خط
    را به فیلدها (ستون‌ها) تقسیم می‌کند و به ما اجازه می‌دهد تا عملیات‌های مختلفی را روی این فیلدها
    انجام دهیم. تسلط بر awk یکی از مهارت‌هایی است که یک کاربر معمولی را از یک کاربر
    حرفه‌ای لینوکس متمایز می‌کند.
  </p>
</section>
<section>
  <h2>ساختار اصلی یک دستور awk</h2>
  <p>
    در نگاه اول، سینتکس awk ممکن است کمی پیچیده به نظر برسد، اما ساختار اصلی آن بسیار
    منطقی است:
  </p>
  <pre dir="ltr" data-cm-lang="bash">$ awk 'pattern { action }' filename</pre>
  <ul class="list-disc pr-6">
    <li>action (عمل): این بخش که درون آکولاد {} قرار می‌گیرد، به awk
      می‌گوید که چه کاری را انجام دهد. مثلاً { print $1 } به معنای «ستون اول را چاپ کن»
      است.</li>
    <li>pattern (الگو): این بخش یک شرط اختیاری است. اگر این شرط برای خط فعلی برقرار باشد،
      action مربوط به آن اجرا می‌شود. اگر هیچ الگویی مشخص نشود، action روی
      تمام خطوط ورودی اجرا می‌گردد.</li>
  </ul>
  <p>مهم‌ترین مفهوم در awk، فیلدها هستند. awk به طور خودکار هر خط ورودی را بر
    اساس یک جداکننده (به طور پیش‌فرض، فاصله یا tab) به فیلدهایی تقسیم می‌کند و آن‌ها را با متغیرهای
    $1، $2، $3 و الی آخر در دسترس قرار می‌دهد. متغیر $0
    نیز همیشه به کل خط فعلی اشاره دارد.</p>
</section>
<section>
  <h2>مثال‌های کاربردی با awk</h2>
  <p>بیایید با چند مثال عملی ببینیم awk چگونه کار می‌کند.</p>
  <h3>مثال ۱: چاپ ستون‌های خاص</h3>
  <p>
    خروجی دستور ls -l یک نمونه عالی از داده‌های ستونی است که با فاصله از هم جدا شده‌اند.
    اگر بخواهیم فقط ستون نهم (نام فایل) و ستون اول (مجوزها) را چاپ کنیم، می‌توانیم خروجی ls -l را به awk پایپ کنیم:
  </p>
  <pre dir="ltr" data-cm-lang="bash">
$ ls -l | awk '{print $9, $1}'
myscript.sh -rwxr-xr-x
another_file.txt -rw-r--r--
...
</pre>
  <h3>مثال ۲: استفاده از جداکننده فیلد متفاوت</h3>
  <p>
    همانطور که گفتیم، جداکننده پیش‌فرض، فاصله است. اما بسیاری از فایل‌ها مانند /etc/passwd از جداکننده‌ی دیگری (در این مورد، کولون :) استفاده می‌کنند.
    برای مشخص کردن جداکننده دلخواه، از گزینه‌ی -F استفاده می‌کنیم. دستور زیر، نام‌های
    کاربری (ستون اول) را از فایل /etc/passwd استخراج می‌کند:
  </p>
  <pre dir="ltr" data-cm-lang="bash">
$ awk -F':' '{print $1}' /etc/passwd
root
daemon
bin
...</pre>
  <h3>مثال ۳: فیلتر کردن با استفاده از الگو</h3>
  <p>
    قدرت awk زمانی بیشتر می‌شود که از الگوها برای فیلتر کردن خطوط استفاده کنیم. الگو
    می‌تواند یک عبارت باقاعده (که در درس بعد با آن آشنا می‌شویم) یا یک شرط منطقی باشد. دستور زیر،
    فقط خطوطی از فایل /etc/passwd را پردازش می‌کند که حاوی کلمه bash باشند و
    سپس نام کاربری (ستون اول) و شل پیش‌فرض (ستون هفتم) آن کاربران را چاپ می‌کند.
  </p>
  <pre dir="ltr" data-cm-lang="bash">
$ awk -F':' '/bash/ {print "User:", $1, "uses shell:", $7}' /etc/passwd
User: root uses shell: /bin/bash
User: me uses shell: /bin/bash</pre>
</section>
<section>
  <h2>بلوک‌های BEGIN و END</h2>
  <p>
    awk دو الگوی بسیار خاص به نام‌های BEGIN و END دارد که به ما
    کنترل بیشتری روی فرآیند پردازش می‌دهند.
  </p>
  <ul class="list-disc pr-6">
    <li>بلوک BEGIN: دستورات داخل این بلوک، قبل از شروع خواندن اولین خط
      ورودی اجرا می‌شوند. این بلوک برای چاپ کردن عنوان (Header) یا مقداردهی اولیه متغیرها عالی
      است.</li>
    <li>بلوک END: دستورات داخل این بلوک، بعد از پایان پردازش تمام خطوط
      ورودی اجرا می‌شوند. این بلوک برای انجام محاسبات نهایی و چاپ خلاصه‌ی نتایج ایده‌آل است.</li>
  </ul>
  <p>
    مثال زیر نشان می‌دهد چگونه می‌توانیم مجموع اعداد یک ستون را محاسبه کنیم. فرض کنید فایلی به نام
    sales.txt با محتوای زیر داریم:
  </p>
  <pre dir="ltr" data-cm-lang="bash">
ProductA 15000
ProductB 22000
ProductC 18000
</pre>
  <p>دستور awk زیر مجموع فروش (ستون دوم) را محاسبه و چاپ می‌کند:</p>
  <pre dir="ltr" data-cm-lang="bash">
$ awk 'BEGIN { print "Sales Report" } { sum += $2 } END { print "Total Sales:", sum }' sales.txt
Sales Report
Total Sales: 55000</pre>
  <p>
    در این دستور، بلوک BEGIN یک عنوان چاپ می‌کند، بلوک میانی به ازای هر خط، مقدار ستون
    دوم را به متغیر sum اضافه می‌کند و بلوک END در نهایت مقدار کل
    sum را نمایش می‌دهد.
  </p>
</section>