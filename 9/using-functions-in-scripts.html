<section data-intro class="bg-slate-900/20">
  <h2>مقدمه</h2>
  <p>
    با یادگیری متغیرها، شرط‌ها و حلقه‌ها، ما ابزارهای لازم برای نوشتن
    اسکریپت‌های قدرتمند را در اختیار داریم. اما با بزرگتر و پیچیده‌تر شدن
    اسکریپت‌ها، مدیریت آن‌ها نیز دشوارتر می‌شود. اگر یک قطعه کد خاص وجود داشته
    باشد که لازم باشد آن را در چندین جای مختلف از اسکریپت خود اجرا کنیم، آیا
    باید آن را هر بار کپی و پیست کنیم؟ این کار نه تنها اسکریپت را طولانی و
    ناخوانا می‌کند، بلکه نگهداری آن را نیز به یک کابوس تبدیل می‌کند.
  </p>
  <p>
    راه حل این مشکل، استفاده از توابع (Functions) است. یک تابع، یک بلوک
    نام‌گذاری شده از کد است که یک وظیفه‌ی خاص را انجام می‌دهد و ما می‌توانیم آن
    را از هر جای اسکریپت خود با صدا زدن نامش، اجرا کنیم. استفاده از توابع سه
    مزیت اصلی دارد:
  </p>
  <ul class="list-disc pr-6">
    <li>
      <b>استفاده مجدد (Reusability):</b> کد را یک بار می‌نویسید و بارها از آن
      استفاده می‌کنید. (اصل برنامه‌نویسی DRY: Don't Repeat Yourself)
    </li>
    <li>
      <b>خوانایی (Readability):</b> با شکستن یک اسکریپت بزرگ به توابع کوچک و
      منطقی، درک عملکرد کلی آن بسیار آسان‌تر می‌شود.
    </li>
    <li>
      <b>نگهداری آسان (Maintainability):</b> اگر نیاز به تغییر یا رفع اشکال در
      یک بخش از کد داشته باشید، فقط کافیست آن را در تعریف تابع مربوطه اصلاح
      کنید.
    </li>
  </ul>
</section>
<section>
  <h2>تعریف و فراخوانی یک تابع</h2>
  <p>
    تعریف یک تابع در شل بسیار ساده است. ما یک نام برای تابع خود انتخاب کرده و
    سپس دستورات مورد نظر را درون آکولاد {} قرار می‌دهیم.
  </p>

  <pre dir="ltr" data-cm-lang="bash">
function_name() {
  echo "Hello from the function!"
}</pre
  >

  <p>
    توجه کنید که تعریف کردن یک تابع، آن را اجرا نمی‌کند. برای اجرای کدهای درون
    تابع، باید آن را فراخوانی (call) کنیم. فراخوانی یک تابع نیز به سادگی تایپ
    کردن نام آن است، درست مانند یک دستور عادی.
  </p>

  <pre dir="ltr" data-cm-lang="bash">
#!/bin/bash

log_message() {
  echo "$(date): an important message"
}

echo "starting script..."
# calling the function
log_message
echo "script continues..."
log_message # calling again
echo "script finished."
</pre>
</section>
<section>
  <h2>ارسال آرگومان به توابع</h2>
  <p>
    توابع زمانی بسیار مفیدتر می‌شوند که بتوانند مقادیر ورودی دریافت کنند. این
    مقادیر ورودی
    <b>آرگومان (Arguments)</b> نامیده می‌شوند. توابع در شل، آرگومان‌های خود را
    دقیقاً مانند خود اسکریپت، از طریق پارامترهای موقعیتی <code>$1</code> (اولین
    آرگومان)، <code>$2</code> (دومین آرگومان) و الی آخر دریافت می‌کنند.
  </p>

  <pre dir="ltr" data-cm-lang="bash">
#!/bin/bash

greet() {
  echo "Hello, $1!"
}

greet "Ali"
greet "Mina"
</pre
  >
</section>
<section>
  <h2>بازگرداندن مقدار از توابع</h2>
  <p>دو روش اصلی برای «بازگرداندن» نتیجه از یک تابع وجود دارد.</p>

  <h3>۱. بازگرداندن کد خروج (Exit Code)</h3>
  <p>
    توابع نیز مانند دستورات عادی می‌توانند یک کد خروج (عددی بین ۰ تا ۲۵۵) را با
    استفاده از دستور
    <code>return</code> برگردانند. این روش برای نشان دادن وضعیت موفقیت (return
    0) یا شکست (return 1) یک تابع عالی است.
  </p>

  <pre dir="ltr" data-cm-lang="bash">
#!/bin/bash
is_root() {
  if [[ "$(id -u)" -eq 0 ]]; then
    return 0  
  else
    return 1 
  fi
}

if is_root; then
  echo "You are running as root."
else
  echo "You are running as a regular user."
fi
</pre
  >

  <h3>۲. بازگرداندن متن (رشته)</h3>
  <p>
    اگر بخواهید یک مقدار متنی (مانند یک نام فایل یا نتیجه یک محاسبه) را از یک
    تابع برگردانید، نباید از <code>return</code> استفاده کنید. در عوض، تابع شما
    باید آن مقدار را با دستور <code>echo</code> چاپ کند. سپس، کدی که تابع را
    فراخوانی کرده، می‌تواند این خروجی را با استفاده از
    <b>جایگزینی دستور <code>$(...)</code></b> دریافت و در یک متغیر ذخیره کند.
  </p>

  <pre dir="ltr" data-cm-lang="bash">
#!/bin/bash

get_kernel_version() {
  uname -r
}

kernel_v=$(get_kernel_version)

echo "Your kernel version is: $kernel_v"
</pre
  >
</section>
<section>
  <h2>حوزه‌ی متغیرها: local در برابر global</h2>
  <p>
    به طور پیش‌فرض، تمام متغیرهایی که در یک اسکریپت شل تعریف می‌کنید،
    <b>عمومی (global)</b> هستند. این یعنی از هر جایی در اسکریپت، چه داخل توابع و
    چه خارج از آن‌ها، قابل دسترسی و تغییر هستند. این موضوع می‌تواند خطرناک باشد،
    زیرا یک تابع ممکن است به صورت ناخواسته مقدار متغیری را که در جای دیگری از
    اسکریپت استفاده می‌شود، تغییر دهد و باعث بروز خطاهای پنهان شود.
  </p>
  <p>
    برای جلوگیری از این مشکل، بهترین کار این است که متغیرهایی که فقط در داخل یک
    تابع استفاده می‌شوند را با کلمه‌ی کلیدی <code>local</code> تعریف کنیم. یک
    متغیر <code>local</code> فقط در همان تابعی که تعریف شده قابل مشاهده است و با
    پایان یافتن اجرای تابع، از بین می‌رود.
  </p>

  <pre dir="ltr" data-cm-lang="bash">
#!/bin/bash
create_message() {
  local name="$1"
  local message="Hello, $name"
  echo "$message"
}

message="This is a global variable."
returned_message=$(create_message "Sara")

echo "Message from function: $returned_message"
echo "Global message is still: $message"
</pre>
</section>
