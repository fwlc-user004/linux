<section>
  <h2>مقدمه</h2>
  <p>
    به فصل پایانی دوره خوش آمدید! در این فصل به سراغ مدیریت منابع اصلی سیستم
    می‌رویم: دیسک، حافظه و پردازنده. پس از پردازنده و حافظه، فضای ذخیره‌سازی
    (دیسک‌ها) یکی از حیاتی‌ترین منابع هر سیستمی است. مدیریت این فضا - یعنی
    دانستن اینکه چه دستگاه‌های ذخیره‌سازی به سیستم متصل هستند، چقدر فضا در دسترس
    است و کدام فایل‌ها و دایرکتوری‌ها بیشترین فضا را مصرف کرده‌اند - یک مهارت
    بنیادی برای هر کاربر و مدیر سیستم لینوکس است.
  </p>
  <p>
    کمبود فضای دیسک می‌تواند به سرعت یک سرور یا کامپیوتر شخصی را از کار بیندازد.
    در این درس، با سه ابزار خط فرمان کلیدی آشنا می‌شویم که به ما کمک می‌کنند تا
    تصویری واضح از وضعیت دیسک‌های خود داشته باشیم و بتوانیم به صورت پیشگیرانه
    فضای ذخیره‌سازی را مدیریت کنیم: <code>lsblk</code>، <code>df</code> و
    <code>du</code>.
  </p>
</section>
<section>
  <h2>مشاهده‌ی دستگاه‌های ذخیره‌سازی با lsblk</h2>
  <p>
    اولین قدم برای مدیریت دیسک، شناختن دستگاه‌های ذخیره‌سازی است که به سیستم ما
    متصل هستند. در لینوکس، هارد دیسک‌ها (HDD)، درایوهای حالت جامد (SSD) و
    حافظه‌های فلش (USB) به عنوان
    <b>دستگاه‌های بلوکی (Block Devices)</b> شناخته می‌شوند. بهترین ابزار برای
    مشاهده‌ی این دستگاه‌ها، دستور <code>lsblk</code> (مخفف <b>L</b>i<b>s</b>t
    <b>Bl</b>oc<b>k</b> Devices) است. این دستور دستگاه‌ها و پارتیشن‌های آن‌ها را
    در یک ساختار درختی خوانا نمایش می‌دهد.
  </p>

  <pre dir="ltr" data-cm-lang="bash">
$ lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0 238.5G  0 disk 
├─sda1   8:1    0   512M  0 part /boot/efi
└─sda2   8:2    0   238G  0 part /
sr0     11:0    1  1024M  0 rom  
</pre>

  <p>ستون‌های مهم این خروجی عبارتند از:</p>
  <table class="table">
    <tr>
      <th>ستون</th>
      <th>توضیح</th>
    </tr>
    <tr>
      <td><code>NAME</code></td>
      <td>
        نام دستگاه یا پارتیشن. <code>sda</code> اولین دیسک SATA/SCSI،
        <code>sda1</code> اولین پارتیشن روی آن دیسک و <code>sda2</code> دومین
        پارتیشن است.
      </td>
    </tr>
    <tr>
      <td><code>SIZE</code></td>
      <td>اندازه‌ی کلی دستگاه یا پارتیشن.</td>
    </tr>
    <tr>
      <td><code>TYPE</code></td>
      <td>
        نوع دستگاه، مانند <code>disk</code> (دیسک)، <code>part</code> (پارتیشن)
        یا <code>rom</code> (درایو نوری).
      </td>
    </tr>
    <tr>
      <td><code>MOUNTPOINT</code></td>
      <td>
        نقطه‌ی اتصال. دایرکتوری‌ای که این پارتیشن در آن به سیستم فایل اصلی متصل
        (mount) شده است.
      </td>
    </tr>
  </table>
</section>
<section>
  <h2>بررسی فضای مصرفی فایل‌سیستم با df</h2>
  <p>
    دستور <code>df</code> (مخفف <b>D</b>isk <b>F</b>ree) به ما نشان می‌دهد که در
    هر یک از فایل‌سیستم‌های متصل‌شده (mount شده) به سیستم، چقدر فضا مصرف شده و
    چقدر فضای خالی باقی مانده است. این دستور برای یک نگاه کلی به وضعیت پر شدن
    دیسک‌ها عالی است.
  </p>
  <p>
    اجرای <code>df</code> به تنهایی، خروجی را بر حسب کیلوبایت نمایش می‌دهد که
    خواندن آن دشوار است. همیشه از گزینه‌ی <code>-h</code> (مخفف
    <b>h</b>uman-readable) استفاده کنید تا اندازه‌ها به صورت مگابایت (M)،
    گیگابایت (G) و ترابایت (T) نمایش داده شوند.
  </p>
  <pre dir="ltr" data-cm-lang="bash">$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda2       228G   45G  172G  21% /
tmpfs           3.9G     0  3.9G   0% /dev/shm
/dev/sda1       511M  6.1M  505M   2% /boot/efi
</pre>
  <p>
    ستون <code>Use%</code> (درصد استفاده) به سرعت به شما نشان می‌دهد که کدام
    پارتیشن در حال پر شدن است و نیاز به توجه دارد.
  </p>
</section>
<section>
  <h2>بررسی فضای مصرفی فایل‌ها و دایرکتوری‌ها با du</h2>
  <p>
    دستور <code>df</code> به ما می‌گوید کل پارتیشن چقدر پر است، اما نمی‌گوید
    <b>چه چیزی</b> این فضا را اشغال کرده است. برای این کار، به سراغ دستور
    <code>du</code> (مخفف <b>D</b>isk <b>U</b>sage) می‌رویم. این دستور حجم فضای
    مصرف‌شده توسط یک فایل یا دایرکتوری خاص (و زیرشاخه‌هایش) را محاسبه می‌کند.
  </p>
  <p>
    اجرای <code>du</code> به تنهایی در یک دایرکتوری بزرگ، اطلاعات زیادی را برای
    تمام زیرشاخه‌ها چاپ می‌کند. معمولاً ما از گزینه‌های زیر برای خلاصه‌سازی
    خروجی استفاده می‌کنیم:
  </p>
  <table class="table">
    <tr>
      <th>آپشن</th>
      <th>توضیح</th>
    </tr>
    <tr>
      <td>-h</td>
      <td>نمایش خروجی به صورت خوانا (human-readable).</td>
    </tr>
    <tr>
      <td>-s</td>
      <td>نمایش فقط خلاصه‌ی مجموع کل (summary) برای دایرکتوری مشخص شده.</td>
    </tr>
    <tr>
      <td>--max-depth=N</td>
      <td>عمق نمایش زیرشاخه‌ها را به N سطح محدود می‌کند.</td>
    </tr>
  </table>

  <p>یک گردش کار رایج برای پیدا کردن مقصر پر شدن دیسک به صورت زیر است:</p>
<pre dir="ltr" data-cm-lang="bash">
# first check the total size of the /var directory</span>
$ sudo du -sh /var
12G     /var


# now see which subdirectories are taking up the most space at depth 1</span>
$ sudo du -h --max-depth=1 /var
4.0K    /var/mail
8.5G    /var/log
3.2G    /var/lib
...
12G     /var
</pre>
  <p>
    این خروجی به وضوح نشان می‌دهد که دایرکتوری‌های <code>/var/log</code> و
    <code>/var/lib</code> مقصران اصلی هستند و باید بررسی شوند.
  </p>
</section>
