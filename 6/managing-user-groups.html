<section data-intro class="bg-slate-900/20">
  <h2>مقدمه</h2>
  <p>
    در درس قبل یاد گرفتیم که چگونه حسابهای کاربری را به صورت انفرادی مدیریت
    کنیم. اما فرض کنید در یک پروژه، تیمی متشکل از ۱۰ توسعه دهنده داریم و همه ی
    آن‌ها باید به مجموعه ای از فایلهای پروژه دسترسی خواندن و نوشتن داشته باشند.
    آیا باید برای هر ۱۰ نفر به صورت جداگانه مجوزها را تنظیم کنیم؟ این روش نه
    تنها زمان بر است، بلکه مدیریت آن نیز بسیار دشوار خواهد بود.
  </p>
  <p>
    راهکار لینوکس برای این مشکل، استفاده از گروههای کاربری (User Groups) است. یک
    گروه، مجموعه ای از کاربران است. با استفاده از گروهها، ما میتوانیم به جای
    تخصیص مجوز به کاربران متعدد، مجوزها را به یک گروه واحد اختصاص دهیم. سپس، با
    اضافه کردن یا حذف کردن کاربران از آن گروه، میتوانیم به سادگی و به صورت
    متمرکز، سطح دسترسی آن‌ها را کنترل کنیم. این مفهوم، اساس مدیریت دسترسی در
    سیستمهای چند کاربره است.
  </p>
</section>
<section>
  <h2>گروه اصلی و گروههای ثانویه</h2>
  <p>
    در لینوکس، هر کاربر حداقل به یک گروه تعلق دارد که به آن گروه اصلی (Primary
    Group) گفته میشود. به طور پیش فرض، وقتی شما یک کاربر جدید ایجاد میکنید
    (مثلاً useradd ali)، لینوکس یک گروه جدید نیز با همان نام (ali) ایجاد کرده و
    آن را به عنوان گروه اصلی آن کاربر تعیین میکند. هر فایلی که این کاربر از این
    پس ایجاد کند، به صورت پیش فرض به این گروه اصلی تعلق خواهد داشت.
  </p>
  <p>
    علاوه بر یک گروه اصلی، هر کاربر میتواند عضو تعداد زیادی گروه ثانویه
    (Secondary Groups) نیز باشد. این گروههای ثانویه هستند که برای اعطای
    دسترسیهای مشترک به منابع مختلف (مانند دایرکتوریهای پروژه، دسترسی به سخت
    افزارهای خاص و غیره) به کار میروند.
  </p>
  <p>
    برای مشاهده ی گروههایی که یک کاربر عضو آنهاست، از دستور id استفاده میکنیم:
  </p>
  <pre dir="ltr" data-cm-lang="bash">
$ id me
uid=1000(me) gid=1000(me) groups=1000(me),27(sudo),100(users),108(developers)
</pre
  >
  <p>
    در این خروجی، gid نشان دهنده ی گروه اصلی کاربر me است (که در اینجا گروه me
    با GID 1000 است) و بخش groups لیست تمام گروههایی (اصلی و ثانویه) را که این
    کاربر عضو آنهاست، نمایش میدهد.
  </p>
</section>
<section>
  <h2>دستورات مدیریت گروه‌ها</h2>
  <p>
    مجموعه دستورات مدیریت گروه‌ها، شباهت زیادی به دستورات مدیریت کاربران دارد و
    اجرای همه‌ی آن‌ها نیازمند دسترسی ریشه (sudo) است.
  </p>

  <h3>۱. ایجاد گروه جدید با groupadd</h3>
  <p>برای ساختن یک گروه جدید، از دستور groupadd به سادگی استفاده می‌کنیم:</p>
  <pre dir="ltr" data-cm-lang="bash">
$ sudo groupadd developers
</pre
  >

  <h3>۲. ویرایش گروه با groupmod</h3>
  <p>
    این دستور کمتر استفاده می‌شود، اما برای کارهایی مثل تغییر نام یک گروه کاربرد
    دارد. برای مثال، برای تغییر نام گروه developers به engineers:
  </p>
  <pre dir="ltr" data-cm-lang="bash">
$ sudo groupmod -n engineers developers
</pre
  >

  <h3>۳. حذف گروه با groupdel</h3>
  <p>برای حذف یک گروه، از دستور groupdel استفاده می‌شود:</p>
  <pre dir="ltr" data-cm-lang="bash">
$ sudo groupdel engineers
</pre
  >

  <div data-callout="info">
    <p>
      توجه داشته باشید که نمی‌توانید گروهی را حذف کنید که گروه اصلی یک کاربر
      موجود است. برای این کار، ابتدا باید گروه اصلی آن کاربر را با دستور usermod
      تغییر دهید.
    </p>
  </div>
</section>
<section>
  <h2>مدیریت عضویت کاربران در گروه‌ها</h2>
  <p>
    رایج‌ترین کار در مدیریت گروه‌ها، افزودن کاربران به گروه‌ها یا حذف آن‌ها از
    گروه‌ها است.
  </p>

  <h3>افزودن کاربر به گروه‌ها</h3>
  <p>
    برای اضافه کردن یک کاربر به یک یا چند گروه ثانویه، از دستور usermod که در
    درس قبل با آن آشنا شدیم، به همراه گزینه‌های -a و -G استفاده می‌کنیم.
  </p>
  <pre dir="ltr" data-cm-lang="bash">
$ sudo usermod -aG developers me
</pre
  >
  <p>
    در این دستور، -G لیست گروه‌های ثانویه را مشخص می‌کند و -a (مخفف append) به
    معنای «الحاق کردن» است. یعنی گروه developers را به لیست گروه‌های فعلی کاربر
    اضافه کن.
  </p>

  <div data-callout="warning">
    <strong>⚠️ هشدار بسیار مهم در مورد گزینه‌ی -a</strong>
    <p>
      فراموش کردن گزینه‌ی -a هنگام استفاده از -G یکی از رایج‌ترین اشتباهات
      کاربران تازه‌کار است. اگر دستور را به صورت sudo usermod -G developers me
      (بدون -a) اجرا کنید، کاربر me از تمام گروه‌های ثانویه دیگر حذف شده و فقط
      عضو گروه developers خواهد شد. این کار می‌تواند دسترسی‌های مهم کاربر (مانند
      دسترسی sudo) را از بین ببرد. همیشه از -aG با هم استفاده کنید.
    </p>
  </div>

  <h3>حذف کاربر از یک گروه</h3>
  <p>
    برای حذف یک کاربر از یک گروه، راه استاندارد استفاده از دستور gpasswd با
    گزینه‌ی -d (مخفف delete) است.
  </p>
  <pre dir="ltr" data-cm-lang="bash">
$ sudo gpasswd -d me developers
Removing user me from group developers
</pre
  >
</section>
<section>
  <h2>مشاهده اطلاعات گروه‌ها</h2>
  <p>
    تمام اطلاعات مربوط به گروه‌های تعریف‌شده در سیستم، در فایل متنی /etc/group
    ذخیره می‌شود. هر خط از این فایل مربوط به یک گروه است و ساختاری به شکل زیر
    دارد:
  </p>
  <pre dir="ltr" data-cm-lang="bash">
group_name:password_placeholder:GID:user_list
</pre
  >
  <p>برای مشاهده‌ی اطلاعات یک گروه خاص، می‌توانیم از grep استفاده کنیم:</p>
  <pre dir="ltr" data-cm-lang="bash">
$ grep "sudo" /etc/group
sudo:x:27:me</pre>
</section>
